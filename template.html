<!DOCTYPE html>
<html>
  <head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  </head>
  <body>

    <div class="container-fluid">
    <div ng-app="w8">
      <div ng-controller="DomainCtrl" class="row">
	<div class="col-sm-12">
	  <h1>W8 Error Listings</h1>
	</div>
	<div id="domainList" class="col-lg-4">
	  <table class="table table-hover table-striped">
            <tr>
              <th>Domain</th>
              <th>Errors</th>
            </tr>
            <tr ng-repeat="domain in domains">
              <td ng-click="getErrors(domain.host)">{{domain.host}}</td>
              <td>{{domain.error_count}}</td>
            </tr>
	  </table>
	</div>
	<div id="errorList" class="col-lg-8">
	  <table class="table table-hover table-striped">
	    <tr>
	      <th>Level</th>
	      <th>Message</th>
	      <th>Time</th>
	    </tr>
	    <tr ng-repeat="error in errors">
	      <td>{{error.level}}</td>
	      <td>{{error.message}}</td>
	      <td>{{error.time}}</td>
	    </tr>
	  </table>
	</div>
      </div>
    </div>
    <script type='text/javascript'>//<![CDATA[ 

var app = angular.module('w8', []);

app.controller('DomainCtrl', function($scope, $http) {
    $scope.domains = [];
    $scope.errors = [];
    var domainHash = '';
    var errorHash = '';

    function getDomains() {
        $http.get('/api/v1.0/domain/list/').success(function(data){
            if(domainHash != data.hash) {
                domainHash = data.hash
                $scope.domains = data.domains;
            }
        });
    }

    $scope.getErrors = function(host) {
        $http.get('/api/v1.0/domain/' + host + '/errors/').success(function(data){
            if(errorHash != data.hash) {
                errorHash = data.hash
                $scope.errors = data.errors;
            }
        });
    }

    getDomains();
    setInterval(function() {getDomains();}, 500);
});
//]]>
    </script>
  </body>
</html>
